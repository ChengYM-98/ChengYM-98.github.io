---
title: JS深浅复制
date: 2022-09-10 17:29:36
tags: JS
categories: 前端基础
cover: /img/01.jpg
---

# 浅拷贝、深拷贝和赋值的区别
当我们把一个对象赋值给另一个新的变量时，赋的其实是对象在栈中的地址，而不是堆中的数据。也就是两个对象指向的是同一个存储空间，无论哪个对象发生改变，其实都是改变的存储空间的内容，因此，两个对象是联动的。

浅拷贝：重新在堆中创建内存，拷贝前后对象的基本数据类型互不影响，而引用类型相互影响。

深拷贝：从堆内存中开辟一个新的区域存放新对象，对对象中的子对象进行递归拷贝，拷贝前后的两个对象互不影响

# 浅拷贝的实现方式
1. Object.assign();
2. 展开运算符：{...obj}
3. Array.prototype.concat();
4. Array.prototype.slice();

# 深拷贝的实现方式
1. JSON.parse(JSON.stringify());

    缺点：函数变为null,正则变为{};
2. lodash：cloneDeep函数
3. 递归实现

```js
    function deepClone(obj, hash = new WeakMap()) {
        if (obj == null) return obj;
        if (obj instanceof Date) return new Date(obj);
        if (obj instanceof RegExp) return new RegExp(obj);
        // 基本类型
        if (typeof obj !== 'object') return obj;
        // 解决循环引用
        if (hash.get(obj)) return hash.get(obj);
        let cloneObj = new obj.constructor();
        hash.set(obj, cloneObj);
        for (let key in obj) {
            if (obj.hasOwnProperty(key)) {
                cloneObj[key] = deepClone(obj[key], hash);
            }
        }
        return cloneObj;
    }
```
